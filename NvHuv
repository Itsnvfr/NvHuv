-- [[ UTILITIES & CONFIG ]]
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

local Config = {
    Aimbot = {Enabled = false, Smooth = 0.8, Shake = 0.05, Part = "Head", Team = true, Wall = true, Alive = true, FOV = 100, ShowFOV = false},
    Silent = {Enabled = false, HitChance = 80, Part = "Head", Team = true, Wall = true, Alive = true, FOV = 150, ShowFOV = false},
    Trigger = {Enabled = false, Team = true, Wall = true, Alive = true, Delay = 0.1, Distance = 500, HitChance = 100},
    Visuals = {Chams = false, Boxes = false, Health = false, HeadDot = false, Team = true, Color = Color3.fromRGB(0, 255, 255), DotSize = 4},
    UI = {Visible = true, Theme = "Dark Glass"}
}

-- [[ UI FRAMEWORK ]]
local ScreenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 750, 0, 500)
Main.Position = UDim2.new(0.5, -375, 0.5, -250)
Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Main.BackgroundTransparency = 0.2
Main.BorderSizePixel = 0

local Corner = Instance.new("UICorner", Main)
Corner.CornerRadius = UDim.new(0, 15)

local Sidebar = Instance.new("Frame", Main)
Sidebar.Size = UDim2.new(0, 180, 1, 0)
Sidebar.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Sidebar.BackgroundTransparency = 0.5

local Container = Instance.new("Frame", Main)
Container.Position = UDim2.new(0, 190, 0, 10)
Container.Size = UDim2.new(1, -200, 1, -20)
Container.BackgroundTransparency = 1

local Layout = Instance.new("UIListLayout", Sidebar)
Layout.Padding = UDim.new(0, 5)

-- [[ FEATURE FUNCTIONS ]]
local function IsValid(plr, cfg)
    if not plr or not plr.Character or not plr.Character:FindFirstChild("Humanoid") then return false end
    if cfg.Alive and plr.Character.Humanoid.Health <= 0 then return false end
    if cfg.Team and plr.Team == LocalPlayer.Team then return false end
    
    local part = plr.Character:FindFirstChild(cfg.Part or "Head")
    if not part then return false end
    
    if cfg.Wall then
        local ray = Ray.new(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000)
        local hit = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character, Camera})
        if hit and not hit:IsDescendantOf(plr.Character) then return false end
    end
    return true
end

local function GetClosest(fov, cfg)
    local target, closest = nil, fov
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and IsValid(v, cfg) then
            local part = v.Character:FindFirstChild(cfg.Part or "Head")
            if part then
                local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
                if dist < closest then
                    target = v
                    closest = dist
                end
            end
        end
    end
    return target
end

-- [[ TABS GENERATOR ]]
local function CreateTab(name)
    local Page = Instance.new("ScrollingFrame", Container)
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundTransparency = 1
    Page.Visible = false
    Page.ScrollBarThickness = 0
    Instance.new("UIListLayout", Page).Padding = UDim.new(0, 10)

    local Btn = Instance.new("TextButton", Sidebar)
    Btn.Size = UDim2.new(1, 0, 0, 45)
    Btn.Text = name
    Btn.Font = Enum.Font.GothamBold
    Btn.TextSize = 16
    Btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Btn.TextColor3 = Color3.fromRGB(255, 255, 255)

    Btn.MouseButton1Click:Connect(function()
        for _, p in pairs(Container:GetChildren()) do p.Visible = false end
        Page.Visible = true
    end)
    return Page
end

-- Create Pages
local AimPage = CreateTab("Aimbot")
local SilentPage = CreateTab("Silent Aim")
local TrigPage = CreateTab("Triggerbot")
local VisualPage = CreateTab("Visuals")
local SkinPage = CreateTab("Skinchanger")
local ConfigPage = CreateTab("Configs/Themes")

-- [[ SKINCHANGER LOGIC ]]
local function LoadSkins()
    if UIS.TouchEnabled and not UIS.KeyboardEnabled then
        loadstring(game:HttpGet("https://pastebin.com/raw/9qnfFYny"))() -- Mobile
    else
        loadstring(game:HttpGet("https://pastebin.com/raw/y5cw6uYV"))() -- PC
    end
end

local SkinBtn = Instance.new("TextButton", SkinPage)
SkinBtn.Size = UDim2.new(1, 0, 0, 50)
SkinBtn.Text = "Execute Skinchanger"
SkinBtn.MouseButton1Click:Connect(LoadSkins)

-- [[ MAIN LOOP ]]
RunService.RenderStepped:Connect(function()
    -- Aimbot Logic (Low-Intensity Smoothness)
    if Config.Aimbot.Enabled then
        local target = GetClosest(Config.Aimbot.FOV, Config.Aimbot)
        if target then
            local pos = target.Character[Config.Aimbot.Part].Position
            local shake = Vector3.new(math.random(-1,1), math.random(-1,1), math.random(-1,1)) * Config.Aimbot.Shake
            -- Adjusted Lerp for "less high" boosting
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, pos + shake), (1 - Config.Aimbot.Smooth) / 5)
        end
    end
end)

-- Silent Aim Hook (Look-At Logic Included)
local oldNC
oldNC = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    if not checkcaller() and Config.Silent.Enabled and (method == "Raycast" or method == "FindPartOnRay") then
        local target = GetClosest(Config.Silent.FOV, Config.Silent)
        if target and math.random(1,100) <= Config.Silent.HitChance then
            local tPos = target.Character[Config.Silent.Part].Position
            if method == "Raycast" then
                args[2] = (tPos - args[1]).Unit * 1000
                return oldNC(self, unpack(args))
            end
        end
    end
    return oldNC(self, ...)
end)

-- Toggle
UIS.InputBegan:Connect(function(input, gpe)
    if not gpe and input.KeyCode == Enum.KeyCode.RightShift then
        Main.Visible = not Main.Visible
    end
end)

Container:GetChildren()[1].Visible = true
print("Glass Premium Loaded | V7 Stable")
